webpackJsonp([22],{"1WCb":function(e,t,a){"use strict";function i(e){a("ut9c")}Object.defineProperty(t,"__esModule",{value:!0});var n=a("mvHQ"),o=a.n(n),c=a("bWJ8"),l=a("qqG0"),s=a("Dod7"),r={name:"TeacherTeaching",components:{Button:c.a,Toast:l.a},data:function(){return{defArrow:this.$store.state.Common.defaultLineArrow,isToast:!1,toast:"",tableLoading:!1,filterText:"",treeData:[{id:1e3,pid:101,label:"烟台一中",group:102,isLeaf:0,isSystem:0,children:[{id:1e4,pid:1e3,label:"初中校区",group:103,isLeaf:0,isSystem:1,children:[{id:10010,pid:1e4,label:"校门口",group:104,isLeaf:1,isSystem:1,children:[]},{id:10011,pid:1e4,label:"传达室",group:104,isLeaf:1,isSystem:1,children:[]},{id:10012,pid:1e4,label:"教学楼",group:104,isLeaf:1,isSystem:1,children:[]}]},{id:10001,pid:1e3,label:"高中校区",group:103,isLeaf:0,isSystem:0,children:[{id:10020,pid:10001,label:"校门口",group:104,isLeaf:1,isSystem:0,children:[]},{id:10021,pid:10001,label:"传达室",group:104,isLeaf:1,isSystem:0,children:[]},{id:10022,pid:10001,label:"教学楼",group:104,isLeaf:1,isSystem:0,children:[]}]}]}],yearid:"",yearData:[],checkedObj:{},courseData:[],tableData:[],classData:[],saveShow:!1,copyShow:!1,copyForm:{yearid:""},placeData:[{placeNo:"1",place_name:"教学楼A"},{placeNo:"2",place_name:"教学楼B"},{placeNo:"3",place_name:"教学楼C"},{placeNo:"4",place_name:"教学楼D"}],uploadParams:{semester_id:3,school_id:localStorage.getItem("schoolId"),start_row:3,start_col:1}}},methods:{hideToast:function(){this.isToast=!1},resizeLayout:function(){setTimeout(function(){var e=$(".index > .m-cen").height(),t=$(".index .education-top").height(),a=$(".index .m-left h4").height(),i=$(".index .m-left .el-input").height(),n=$(".index .teaching-top").height(),o=e-t-n-10;$(".teacher-teaching .table-box").height(o);var c=e-t-a-i-30;$(".teacher-teaching .m-left .inner .el-tree").height(c)},50)},filterNode:function(e,t){return!e||(-1!==String(t.id).indexOf(e)||-1!==t.label.indexOf(e))},handleNodeClick:function(e,t){1==e.isTeacher&&($(".span").removeClass("custom-tree-node"),this.$refs[e.id].classList.add("custom-tree-node"),this.checkedObj=e)},cellClick:function(e,t,a,i){if(this.saveShow&&"{}"!=o()(this.checkedObj)&&"className"!=t.property){var n="";this.tableData.forEach(function(t,a){if(t.classid==e.classid)return void(n=a)}),this.checkedObj.label!=e[t.property+"teacherName"]?(e[t.property+"teacherName"]=this.checkedObj.label,e[t.property+"teacherid"]=this.checkedObj.id):e[t.property]!=this.copyTableData[n][t.property]&&(e[t.property]=this.copyTableData[n][t.property]),a.classList.add("add-teacher")}},delTeacher:function(e,t){e[t+"teacherName"]=""},customClick:function(e,t,a,i){},editSave:function(){if(this.saveShow=!this.saveShow,this.saveShow)this.copyTableData=JSON.parse(o()(this.tableData));else{for(var e=[],t=0;t<this.tableData.length;t++)for(var a=0;a<this.courseData.length;a++)this.tableData[t]["subjectName"+this.courseData[a].subjectid+"teacherName"]&&e.push({classid:this.tableData[t].classid,subjectid:this.courseData[a].subjectid,teacherid:this.tableData[t]["subjectName"+this.courseData[a].subjectid+"teacherid"]});this.putTeaching(e)}},copyClick:function(){this.getTeachingList("copy")},saveCopyClick:function(){var e=this;this.copyShow=!1;var t={currentid:this.yearid,copyid:this.copyForm.yearid,schoolid:localStorage.getItem("schoolId")};this.$loading(),this.$api.EducationManage.copyTeaching("post",t).then(function(t){e.$loading().close(),600==t.data.code||0==t.data.code?e.getTeaching(e.yearid):(e.isToast=!0,e.toast=t.data.msg)}).catch(function(t){e.$loading().close()})},beforeUpload:function(e){var t=e.name.toLowerCase().split("."),a=[],i=!1;if(t.length>0&&(a=t[t.length-1],i="xlsx xls".indexOf(a)>-1),!i)return this.$message({showClose:!0,type:"warning",message:"只能上传elcel表格!",duration:this.msgDuration}),!1},changeUpload:function(e,t){},uploadSuccess:function(e,t,a){this.uploadSuccessDialog=!0},uploadError:function(e,t,a){},getTeachingList:function(e){var t=this,a={schoolid:localStorage.getItem("schoolId")};this.$api.EducationManage.getTeachingList("get",a).then(function(a){if(600==a.data.code||0==a.data.code){if(t.yearData=a.data.data,e)return t.copyShow=!0,t.copyForm={yearid:""},void setTimeout(function(){t.$refs.copyForm.resetFields()},20);t.yearData.length>0&&(t.yearid=t.yearData[0].id,t.getTeaching(t.yearid))}else t.isToast=!0,t.toast=a.data.msg}).catch(function(e){})},getTeachingClassList:function(){var e=this,t={school_id:localStorage.getItem("schoolId")};this.$api.EducationManage.getTeachingClassList("get",t).then(function(t){600==t.data.code||0==t.data.code?e.treeData=t.data.data:(e.isToast=!0,e.toast=t.data.msg)}).catch(function(e){})},getTeaching:function(e){var t=this,a={timeTableid:e,schoolid:localStorage.getItem("schoolId")};this.$api.EducationManage.getTeaching("get",a).then(function(e){600==e.data.code||0==e.data.code?(e.data.data.subject.forEach(function(e){e["subjectName"+e.subjectid]=e.subjectName}),t.courseData=e.data.data.subject,e.data.data.table.forEach(function(e){t.courseData.forEach(function(t){e["subjectName"+t.subjectid]="",e["subjectName"+t.subjectid+"id"]=0,e["subjectName"+t.subjectid+"teacherid"]=0,e["subjectName"+t.subjectid+"teacherName"]=""}),e.row.forEach(function(t){e.cellid=t.id,e["subjectName"+t.subjectid]=t.subjectName,e["subjectName"+t.subjectid+"id"]=t.subjectid,e["subjectName"+t.subjectid+"teacherid"]=t.teacherid,e["subjectName"+t.subjectid+"teacherName"]=t.teacherName})}),t.tableData=e.data.data.table):(t.isToast=!0,t.toast=e.data.msg)}).catch(function(e){})},putTeaching:function(e){var t=this,a={schoolid:localStorage.getItem("schoolId"),data:e};this.$api.EducationManage.putTeaching(a,this.yearid).then(function(e){600==e.data.code||0==e.data.code?($(".add-teacher").removeClass("add-teacher"),t.getTeaching(t.yearid)):(t.isToast=!0,t.toast=e.data.msg)}).catch(function(e){})},changeYear:function(e){this.getTeaching(e)},getTreeData:function(){var e=this,t={school_id:localStorage.getItem("schoolId")};this.$api.EducationManage.getTeachingClassList("get",t).then(function(t){600==t.data.code||0==t.data.code?e.treeData=t.data.data:(e.isToast=!0,e.toast=t.data.msg)})}},watch:{filterText:function(e){this.$refs.tree.filter(e)}},mounted:function(){this.roleActions=this.$store.state.Common.roleActions,this.serverUrl=s.a.bd,this.resizeLayout()},created:function(){this.getTreeData(),this.getTeachingList()}},d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"teacher-teaching"},[a("div",{staticClass:"m-left"},[a("h4",[e._v("教职工档案")]),e._v(" "),a("div",{staticClass:"inner"},[a("el-input",{attrs:{placeholder:"请输入姓名或工号",size:"small"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),a("el-tree",{ref:"tree",attrs:{data:e.treeData,"node-key":"id","default-expand-all":"","check-on-click-node":!0,"filter-node-method":e.filterNode},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var i=(t.node,t.data);return a("span",{ref:i.id,staticClass:"span",attrs:{title:"工号："+i.userNo}},[e._v("\n          "+e._s(i.label)+"\n          ")])}}])})],1)]),e._v(" "),a("div",{staticClass:"m-right"},[a("div",{staticClass:"teaching-top"},[a("dd",[e._v("排课周期：")]),e._v(" "),a("el-select",{staticStyle:{width:"270px"},attrs:{placeholder:"请选择学年",size:"medium"},on:{change:e.changeYear},model:{value:e.yearid,callback:function(t){e.yearid=t},expression:"yearid"}},e._l(e.yearData,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1),e._v(" "),a("Button",{attrs:{title:e.saveShow?"保存":"编辑",btnClass:e.saveShow?"custom8":"custom6",btnFontSize:"12px"},on:{click:e.editSave}}),e._v(" "),a("Button",{attrs:{title:"复制教师课表",btnClass:"custom6",btnFontSize:"12px"},on:{click:e.copyClick}}),e._v(" "),a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{name:"excel",action:this.serverUrl+"/edu/importTeaching",data:e.uploadParams,"show-file-list":!1,"on-change":e.changeUpload,"before-upload":e.beforeUpload,"on-success":e.uploadSuccess,"on-error":e.uploadError}},[a("Button",{attrs:{title:"导入",btnClass:"custom6",btnFontSize:"12px"}})],1),e._v(" "),a("Button",{attrs:{title:"导出",btnClass:"custom6",btnFontSize:"12px"},on:{click:function(e){}}})],1),e._v(" "),a("div",{staticClass:"table-box"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{id:"table",height:"100%",border:"",align:"center",data:e.tableData,"tooltip-effect":"dark","highlight-current-row":""},on:{"cell-click":e.cellClick}},[a("el-table-column",{attrs:{fixed:"left",label:"班级教师课程",align:"center",prop:"className","min-width":"160"}}),e._v(" "),e._l(e.courseData,function(t,i){return a("el-table-column",{key:i,attrs:{prop:"subjectName"+t.subjectid,"min-width":"100",label:t.subjectName,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(i){return[a("dd",[e._v(e._s(i.row["subjectName"+t.subjectid+"teacherName"]))]),e._v(" "),a("i",{directives:[{name:"show",rawName:"v-show",value:e.saveShow&&""!=i.row["subjectName"+t.subjectid+"teacherName"],expression:"saveShow && scope.row['subjectName'+course.subjectid+'teacherName'] != ''"}],staticClass:"iconfont icon-chuyidong",on:{click:function(a){return a.stopPropagation(),e.delTeacher(i.row,"subjectName"+t.subjectid)}}})]}}])})})],2)],1)]),e._v(" "),a("el-dialog",{staticClass:"member-dialog",attrs:{title:"复制课表",visible:e.copyShow,width:"700px",center:""},on:{"update:visible":function(t){e.copyShow=t}}},[a("div",{staticClass:"content"},[a("el-form",{ref:"copyForm",attrs:{"label-width":"100px",model:e.copyForm}},[a("el-form-item",{attrs:{label:"选择课表：",prop:"yearid"}},[a("el-select",{staticStyle:{width:"270px"},attrs:{placeholder:"请选择学年",size:"medium"},model:{value:e.copyForm.yearid,callback:function(t){e.$set(e.copyForm,"yearid",t)},expression:"copyForm.yearid"}},e._l(e.yearData,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id,disabled:t.id==e.yearid}})}),1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{title:"取消",btnClass:"custom7",btnFontSize:"12px",btnHeight:"4.5vh"},on:{click:function(t){e.copyShow=!1}}}),e._v(" "),a("Button",{attrs:{title:"保存",btnClass:"custom8",btnFontSize:"12px",btnHeight:"4.5vh"},on:{click:e.saveCopyClick}})],1)]),e._v(" "),e.isToast?a("Toast",{attrs:{"modal-title":e.toast,duration:"1500"},on:{toastCancel:e.hideToast}}):e._e()],1)},h=[],u={render:d,staticRenderFns:h},g=u,p=a("VU/8"),m=i,f=p(r,g,!1,m,"data-v-e87c6940",null);t.default=f.exports},WhcF:function(e,t,a){t=e.exports=a("FZ+f")(!1),t.push([e.i,"\n.teacher-teaching[data-v-e87c6940] {\n  width: 100%;\n  height: 100%;\n  margin: 0 auto;\n  background-color: #fff;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n}\n.teacher-teaching .m-left[data-v-e87c6940] {\n    -ms-flex-preferred-size: 330px;\n        flex-basis: 330px;\n    min-width: 330px;\n    text-align: center;\n    background-color: #fff;\n    font-size: 12px;\n    overflow: hidden;\n}\n.teacher-teaching .m-left h4[data-v-e87c6940] {\n      width: 100%;\n      height: 60px;\n      line-height: 60px;\n      font-size: 18px;\n      font-weight: bold;\n      color: #666;\n      text-align: left;\n      padding-left: 30px;\n      border-bottom: 1px solid #e1e1e1;\n      border-right: 1px solid #e1e1e1;\n      background-color: #eff3f6;\n}\n.teacher-teaching .m-left .inner[data-v-e87c6940] {\n      width: 100%;\n      height: 100%;\n      overflow: auto;\n      position: relative;\n}\n.teacher-teaching .m-left .inner .el-input[data-v-e87c6940] {\n        width: 90%;\n        margin-top: 10px;\n        margin-bottom: 10px;\n}\n.teacher-teaching .m-left .inner .span[data-v-e87c6940] {\n        padding: 5px 20px;\n}\n.teacher-teaching .m-left .inner .el-tree[data-v-e87c6940] {\n        padding-left: 30px;\n        height: 100%;\n        overflow: auto;\n}\n.teacher-teaching .m-left .inner .custom-tree-node[data-v-e87c6940] {\n        background-color: #1cab7d;\n        color: #fff;\n}\n.teacher-teaching .m-right[data-v-e87c6940] {\n    height: auto;\n    -webkit-box-flex: 1;\n        -ms-flex: 1;\n            flex: 1;\n    text-align: right;\n    min-width: 0;\n}\n.teacher-teaching .m-right .teaching-top[data-v-e87c6940] {\n      min-height: 60px;\n      line-height: 60px;\n}\n.teacher-teaching .m-right .teaching-top .upload-demo[data-v-e87c6940] {\n        display: inline-block;\n}\n.teacher-teaching .m-right .teaching-top dd[data-v-e87c6940] {\n        float: left;\n        margin-left: 40px;\n        margin-right: 10px;\n        font-size: 18px;\n        font-weight: bold;\n}\n.teacher-teaching .m-right .teaching-top .el-select[data-v-e87c6940] {\n        float: left;\n}\n.teacher-teaching .m-right .teaching-top .button-div[data-v-e87c6940] {\n        margin-right: 11px;\n}\n.teacher-teaching .m-right .table-box[data-v-e87c6940] {\n      width: 100%;\n      height: 100%;\n      overflow: auto;\n      /* ------------ */\n      /* ------------ */\n}\n.teacher-teaching .m-right .table-box .add-teacher dd[data-v-e87c6940] {\n        color: #ff4e4e;\n}\n.teacher-teaching .m-right .table-box .cell[data-v-e87c6940] {\n        position: relative;\n        font-size: 12px;\n}\n.teacher-teaching .m-right .table-box .cell:hover i[data-v-e87c6940] {\n          display: block;\n}\n.teacher-teaching .m-right .table-box .cell i[data-v-e87c6940] {\n          position: absolute;\n          top: 0;\n          right: 0;\n          font-size: 20px;\n          color: #ff4e4e;\n          display: none;\n          cursor: pointer;\n}\n.teacher-teaching .m-right .table-box .custom-table[data-v-e87c6940] {\n        text-align: center;\n}\n.teacher-teaching .m-right .table-box .custom-table .custon-top[data-v-e87c6940] {\n          height: 40px;\n          line-height: 40px;\n}\n.teacher-teaching .m-right .table-box .custom-table .custon-top li[data-v-e87c6940] {\n            width: 100px;\n            text-align: center;\n            border: 1px solid red;\n}\n.teacher-teaching .m-right .table-box .custom-table .custon-content[data-v-e87c6940] {\n          overflow: hidden;\n}\n.teacher-teaching .m-right .table-box .custom-table .custon-content > li[data-v-e87c6940] {\n            width: 100%;\n            text-align: center;\n            overflow: hidden;\n}\n.teacher-teaching .m-right .table-box .custom-table .custon-content > li span[data-v-e87c6940] {\n              float: left;\n}\n.teacher-teaching .m-right .table-box .custom-table .custon-content > li ul[data-v-e87c6940] {\n              float: left;\n              overflow: hidden;\n}\n.teacher-teaching .m-right .table-box .custom-table .custon-content > li ul li[data-v-e87c6940] {\n                float: left;\n                border: 1px solid red;\n}\n.teacher-teaching .member-dialog[data-v-e87c6940] .el-dialog {\n    margin-top: 15vh !important;\n}\n.teacher-teaching .member-dialog[data-v-e87c6940] .el-dialog .el-select__input {\n      display: inline !important;\n      border: none !important;\n}\n.teacher-teaching .member-dialog[data-v-e87c6940] .el-dialog .el-dialog__body {\n      padding-bottom: 0 !important;\n}\n.teacher-teaching .member-dialog[data-v-e87c6940] .el-dialog .el-form {\n      text-align: left;\n}\n.teacher-teaching .member-dialog[data-v-e87c6940] .el-dialog .el-form .el-form-item {\n        padding-bottom: 0 !important;\n}\n.teacher-teaching .member-dialog[data-v-e87c6940] .el-dialog .el-form .el-form-item__content .el-select {\n        margin-right: 10px;\n}\n.teacher-teaching .member-dialog[data-v-e87c6940] .el-dialog .el-form .el-input {\n        margin-right: 10px;\n        margin-bottom: 10px;\n}\n.teacher-teaching .member-dialog[data-v-e87c6940] .el-dialog .button-div {\n      margin-right: 20px;\n}\n",""])},ut9c:function(e,t,a){var i=a("WhcF");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("rjj0")("d4ce9ad4",i,!0,{})}});